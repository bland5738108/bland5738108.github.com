function Bullet(t,i){Sprite.call(this,t),this.sx=BULLET_SIZE[i].x,this.sy=BULLET_SIZE[i].y,this.width=BULLET_SIZE[i].width,this.height=BULLET_SIZE[i].height,this.iSpeed=6,this.type=i}function Cannon(t,i){Sprite.call(this,t["cannon"+i]),this.width=CANNONE_SIZE[i].width,this.height=CANNONE_SIZE[i].height,this.type=i}function loadImage(t,i){var h=0,n=0,e={};for(var s in t){n++;var o=new Image;o.src=t[s],e[s]=o,o.onload=function(){h++,h==n&&i&&i(e)}}}function rnd(t,i){return Math.floor(Math.random()*(i-t)+t)}function d2a(t){return t*Math.PI/180}function a2d(t){return 180*t/Math.PI}function DieFish(t,i){Sprite.call(this,t["fish"+i]),this.width=FISH_SIZE[i].width,this.height=FISH_SIZE[i].height,this.sx=4*this.width,this.die=0}function Fish(t,i){Sprite.call(this,t["fish"+i]),this.width=FISH_SIZE[i].width,this.height=FISH_SIZE[i].height,this.iSpeed=3,this.type=i}function Sprite(t){this.img=t,this.x=0,this.y=0,this.sx=0,this.sy=0,this.width=0,this.height=0,this.iSpeed=0,this.r=0}var BULLET_SIZE=[null,{width:24,height:26,x:86,y:0},{width:25,height:29,x:61,y:0},{width:27,height:31,x:32,y:35},{width:29,height:33,x:30,y:82},{width:30,height:34,x:0,y:82},{width:31,height:35,x:30,y:0},{width:32,height:38,x:0,y:44}];Bullet.prototype=new Sprite,Bullet.prototype.constructor=Bullet;var CANNONE_SIZE=[null,{width:74,height:74},{width:74,height:76},{width:74,height:76},{width:74,height:83},{width:74,height:85},{width:74,height:90},{width:74,height:94}];Cannon.prototype=new Sprite,Cannon.prototype.constructor=Cannon,DieFish.prototype=new Sprite,DieFish.prototype.constructor=DieFish,DieFish.prototype.stru=function(){this.sx+=this.width,this.sx>=8*this.width&&(this.sx=4*this.width,this.die=1)};var FISH_SIZE=[null,{width:37,height:55},{width:64,height:78},{width:56,height:72},{width:59,height:77},{width:122,height:107}];Fish.prototype=new Sprite,Fish.prototype.constructor=Fish,Fish.prototype.swim=function(){this.sx+=this.width,this.sx>=4*this.width&&(this.sx=0)},window.onload=function(){var t=document.getElementById("c1"),i=t.getContext("2d");loadImage(resources,function(h){var n=new Sprite(h.bottom),e=new Cannon(h,1),s=[],o=[],r=[];n.width=765,n.height=71,n.x=t.width/2,n.y=t.height-n.height/2,e.x=n.x+e.width/2+6,e.y=n.y,t.onmousemove=function(i){var h=i.pageX-t.offsetLeft,n=i.pageY-t.offsetTop,s=h-e.x,o=n-e.y;e.r=a2d(Math.atan2(o,s))+90},t.onclick=function(){var t=new Audio;t.src="mp3/gunShot.mp3",t.play();var i=new Bullet(h.bullet,e.type);i.x=e.x,i.y=e.y,i.r=e.r,s.push(i)},setInterval(function(){var i=new Fish(h,rnd(1,6));i.x=-50,i.y=rnd(0,t.height),i.r=rnd(45,135),o.push(i)},500),setInterval(function(){i.clearRect(0,0,t.width,t.height),n.draw(i);for(var a=0;a<s.length;a++)s[a].draw(i),s[a].move();for(var a=0;a<o.length;a++)o[a].draw(i),o[a].move();for(var a=0;a<r.length;a++)r[a].draw(i);for(var a=0;a<s.length;a++)for(var g=0;g<o.length;g++)if(s[a].collTest(o[g])){s.splice(a,1),a--;var d=new DieFish(h,o[g].type);d.x=o[g].x,d.y=o[g].y,d.r=o[g].r,r.push(d),o.splice(g,1),g--}for(var a=0;a<r.length;a++)1==r[a].die&&(r.splice(a,1),a--);for(var a=0;a<s.length;a++)(s[a].x<-100||s[a].y<-100||s[a].x>t.width+100||s[a].y>t.height+100)&&(s.splice(a,1),a--);for(var a=0;a<o.length;a++)(o[a].x<-100||o[a].y<-100||o[a].x>t.width+100||o[a].y>t.height+100)&&(o.splice(a,1),a--);e.draw(i)},30),setInterval(function(){for(var t=0;t<o.length;t++)o[t].swim();for(var t=0;t<r.length;t++)r[t].stru()},120)})};var resources={fish1:"img/fish1.png",fish2:"img/fish2.png",fish3:"img/fish3.png",fish4:"img/fish4.png",fish5:"img/fish5.png",bullet:"img/bullet.png",bottom:"img/bottom.png",cannon1:"img/cannon1.png",cannon2:"img/cannon2.png",cannon3:"img/cannon3.png",cannon4:"img/cannon4.png",cannon5:"img/cannon5.png",cannon6:"img/cannon6.png",cannon7:"img/cannon7.png"};Sprite.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.r)),t.drawImage(this.img,this.sx,this.sy,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height),t.restore()},Sprite.prototype.move=function(){var t=Math.sin(d2a(this.r))*this.iSpeed,i=-Math.cos(d2a(this.r))*this.iSpeed;this.x+=t,this.y+=i},Sprite.prototype.collTest=function(t){var i=t.x-this.x,h=t.y-this.y,n=Math.sqrt(i*i+h*h);return n<30};